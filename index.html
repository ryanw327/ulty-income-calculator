<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ULTY Income Calculator</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React and ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-[#F9FAFB] min-h-screen">
  <div id="root" class="container mx-auto p-6"></div>

  <script type="text/babel">
    const { useState, useMemo, useEffect, useRef } = React;

    function App() {
      // State variables
      const [shares, setShares] = useState(3000);
      const [avgCost, setAvgCost] = useState(5.96);
      const [currentPrice, setCurrentPrice] = useState(5.8);
      const [weeklyDist, setWeeklyDist] = useState(0.10);
      const [roc, setRoc] = useState(1); // 1 = 100% Return of Capital (non-taxable)

      // Compute schedule and metrics
      const schedule = useMemo(() => {
        let totalSharesVar = parseFloat(shares);
        const rows = [];
        const labels = [];
        const incomeData = [];
        const sharesData = [];
        const taxableYTD = [];
        let accTaxable = 0;

        for (let i = 0; i < 52; i++) {
          const distPaid = weeklyDist * totalSharesVar;
          const reinvested = distPaid; // no cash hold/withdrawal for now
          const newShares = reinvested / currentPrice;
          totalSharesVar += newShares;
          const monthlyIncome = distPaid * 4.333;
          const annualIncome = distPaid * 52;
          const taxableWeek = distPaid * (1 - roc);
          accTaxable += taxableWeek;

          rows.push({
            week: i + 1,
            distributionPaid: distPaid,
            newShares: newShares,
            totalShares: totalSharesVar,
            monthlyIncome: monthlyIncome,
            annualIncome: annualIncome,
            taxableWeek: taxableWeek,
            taxableYTD: accTaxable
          });
          labels.push(`W${i + 1}`);
          incomeData.push(annualIncome);
          sharesData.push(totalSharesVar);
          taxableYTD.push(accTaxable);
        }
        return { rows, labels, incomeData, sharesData, taxableYTD, finalTotals: totalSharesVar };
      }, [shares, currentPrice, weeklyDist, roc]);

      // Final metrics
      const finalRow = schedule.rows[schedule.rows.length - 1] || {};
      const avgMonthlyIncome = finalRow.monthlyIncome || 0;
      const annualizedIncome = finalRow.annualIncome || 0;
      const totalValue = finalRow.totalShares * currentPrice || 0;
      const initialInvestment = shares * avgCost;
      const totalReturn = totalValue - initialInvestment;
      const taxableYTDTotal = finalRow.taxableYTD || 0;

      // Chart
      const chartRef = useRef(null);

      useEffect(() => {
        const ctx = chartRef.current.getContext('2d');
        if (chartRef.current.chartInstance) {
          chartRef.current.chartInstance.destroy();
        }
        chartRef.current.chartInstance = new Chart(ctx, {
          type: 'line',
          data: {
            labels: schedule.labels,
            datasets: [
              {
                label: 'Annualized Income',
                data: schedule.incomeData,
                borderWidth: 2,
                fill: false,
                tension: 0.1
              },
              {
                label: 'Total Shares',
                data: schedule.sharesData,
                borderWidth: 2,
                fill: false,
                tension: 0.1,
                yAxisID: 'y1'
              }
            ]
          },
          options: {
            responsive: true,
            interaction: { mode: 'index', intersect: false },
            scales: {
              y: {
                beginAtZero: true,
                title: { display: true, text: 'Annualized Income ($)' }
              },
              y1: {
                beginAtZero: true,
                position: 'right',
                title: { display: true, text: 'Total Shares' },
                grid: { drawOnChartArea: false }
              }
            },
            plugins: {
              legend: { position: 'top' }
            }
          }
        });
      }, [schedule]);

      return (
        <div className="space-y-8">
          {/* Header */}
          <header className="bg-[#065F46] text-white p-6 rounded-md shadow">
            <h1 className="text-3xl font-bold text-center">ULTY Income Calculator</h1>
          </header>

          {/* Summary Metrics */}
          <section className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4">
            <div className="bg-[#A7F3D0] p-4 rounded-md border-l-4 border-[#065F46] shadow">
              <h2 className="text-lg font-semibold">Avg Monthly Income</h2>
              <p className="text-2xl font-bold">${avgMonthlyIncome.toFixed(2)}</p>
            </div>
            <div className="bg-[#A7F3D0] p-4 rounded-md border-l-4 border-[#065F46] shadow">
              <h2 className="text-lg font-semibold">Annualized Income</h2>
              <p className="text-2xl font-bold">${annualizedIncome.toFixed(2)}</p>
            </div>
            <div className="bg-[#A7F3D0] p-4 rounded-md border-l-4 border-[#065F46] shadow">
              <h2 className="text-lg font-semibold">Portfolio Value</h2>
              <p className="text-2xl font-bold">${totalValue.toFixed(2)}</p>
            </div>
            <div className="bg-[#A7F3D0] p-4 rounded-md border-l-4 border-[#065F46] shadow">
              <h2 className="text-lg font-semibold">YTD Taxable Income</h2>
              <p className="text-2xl font-bold">${taxableYTDTotal.toFixed(2)}</p>
            </div>
            <div className="bg-[#A7F3D0] p-4 rounded-md border-l-4 border-[#065F46] shadow">
              <h2 className="text-lg font-semibold">Total Return</h2>
              <p className="text-2xl font-bold">${totalReturn.toFixed(2)}</p>
            </div>
          </section>

          {/* Inputs & Chart */}
          <section className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            {/* Inputs */}
            <div className="bg-[#A7F3D0] p-4 rounded-md shadow">
              <h2 className="text-xl font-semibold mb-3">Inputs</h2>
              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium">Number of Shares</label>
                  <input type="number" className="mt-1 p-2 border rounded w-full" value={shares}
                    onChange={(e) => setShares(parseFloat(e.target.value) || 0)} />
                </div>
                <div>
                  <label className="block text-sm font-medium">Average Cost per Share ($)</label>
                    <input type="number" step="0.01" className="mt-1 p-2 border rounded w-full" value={avgCost}
                    onChange={(e) => setAvgCost(parseFloat(e.target.value) || 0)} />
                </div>
                <div>
                  <label className="block text-sm font-medium">Current Share Price ($)</label>
                  <input type="number" step="0.01" className="mt-1 p-2 border rounded w-full" value={currentPrice}
                    onChange={(e) => setCurrentPrice(parseFloat(e.target.value) || 0)} />
                </div>
                <div>
                  <label className="block text-sm font-medium">Weekly Distribution per Share ($)</label>
                  <input type="number" step="0.001" className="mt-1 p-2 border rounded w-full" value={weeklyDist}
                    onChange={(e) => setWeeklyDist(parseFloat(e.target.value) || 0)} />
                </div>
                <div>
                  <label className="block text-sm font-medium">Return of Capital (%)</label>
                  <input type="number" step="0.01" min="0" max="1" className="mt-1 p-2 border rounded w-full" value={roc}
                    onChange={(e) => setRoc(parseFloat(e.target.value) || 0)} />
                  <p className="text-xs text-gray-600">1 = 100% ROC, 0.5 = 50% ROC, etc.</p>
                </div>
              </div>
            </div>

            {/* Chart */}
            <div className="bg-white p-4 rounded-md shadow">
              <h2 className="text-xl font-semibold mb-3">Income & Shares Growth</h2>
              <canvas ref={chartRef} height="300"></canvas>
            </div>
          </section>

          {/* Weekly Schedule */}
          <section className="bg-white p-4 rounded-md shadow overflow-x-auto">
            <h2 className="text-xl font-semibold mb-3">Weekly Schedule (First 12 Weeks)</h2>
            <table className="min-w-full table-auto text-sm">
              <thead className="bg-gray-50">
                <tr>
                  <th className="px-2 py-1 border">Week</th>
                  <th className="px-2 py-1 border">Distribution Paid ($)</th>
                  <th className="px-2 py-1 border">New Shares</th>
                  <th className="px-2 py-1 border">Total Shares</th>
                  <th className="px-2 py-1 border">Monthly Income ($)</th>
                  <th className="px-2 py-1 border">Annual Income ($)</th>
                  <th className="px-2 py-1 border">Taxable YTD ($)</th>
                </tr>
              </thead>
              <tbody>
                {schedule.rows.slice(0, 12).map((row) => (
                  <tr key={row.week} className={row.week % 2 === 0 ? 'bg-gray-100' : ''}>
                    <td className="px-2 py-1 border">{row.week}</td>
                    <td className="px-2 py-1 border">${row.distributionPaid.toFixed(2)}</td>
                    <td className="px-2 py-1 border">{row.newShares.toFixed(4)}</td>
                    <td className="px-2 py-1 border">{row.totalShares.toFixed(4)}</td>
                    <td className="px-2 py-1 border">${row.monthlyIncome.toFixed(2)}</td>
                    <td className="px-2 py-1 border">${row.annualIncome.toFixed(2)}</td>
                    <td className="px-2 py-1 border">${row.taxableYTD.toFixed(2)}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </section>

          {/* Footer / Tip Jar */}
          <footer className="text-center text-sm text-gray-600 mt-8">
            If this tool helped you, consider leaving a tip. 
            <a href="#" className="ml-1 text-[#065F46] font-semibold underline hover:text-[#FBBF24]">
              Tip Jar
            </a>
          </footer>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
